<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blogs Con Juli - YouTube Feed</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- Global Page Styles --- */
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        color: #333;
      }

      .welcome-banner {
        background: #eaeaea;
        text-align: center;
        padding: 20px;
      }

      .welcome-text {
        font-family: "Dancing Script", cursive;
        font-size: 2.5em;
        margin: 0;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
      }

      .channel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
        padding: 10px;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }

      .channel-avatar {
        border-radius: 50%;
        margin-right: 20px;
      }

      .channel-info {
        flex-grow: 1;
      }

      .channel-name {
        font-size: 1.8em;
        margin: 0;
      }

      .channel-stats {
        color: #555;
      }

      /* New player section */
      .player-section {
        display: none; /* Initially hidden */
        margin-bottom: 30px;
      }

      .player-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        background: #000;
        border-radius: 8px;
      }

      .player-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      .video-title-large {
        font-size: 1.5em;
        margin: 15px 0 5px;
        font-weight: bold;
      }

      .video-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .video-meta {
        color: #777;
      }

      .video-actions {
        display: flex;
        gap: 10px;
      }

      .action-button {
        display: flex;
        align-items: center;
        gap: 5px;
        background: #f1f1f1;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .action-button:hover {
        background: #e0e0e0;
      }

      /* Video grid styles */
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .video-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease;
        cursor: pointer;
      }

      .video-card:hover {
        transform: translateY(-5px);
      }

      .thumbnail {
        position: relative;
      }

      .thumbnail img {
        width: 100%;
        display: block;
      }

      .video-duration {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8em;
      }

      .video-info {
        padding: 10px;
      }

      .video-title {
        font-size: 1.1em;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .video-channel,
      .video-stats {
        font-size: 0.9em;
        color: #777;
      }

      /* --- Dynamic Color Changing Subscribe Button --- */
      .subscribe-button {
        padding: 12px 24px;
        font-size: 18px;
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        background: linear-gradient(
          270deg,
          #ff8a00,
          #e52e71,
          #9b00ff,
          #ff8a00
        );
        background-size: 800% 800%;
        animation: colorShift 10s ease infinite;
        transition: transform 0.3s ease;
      }

      .subscribe-button:hover {
        transform: scale(1.05);
      }

      @keyframes colorShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* --- Empty Screen Placeholder --- */
      .empty-screen {
        position: relative;
        background: #4a90e2; /* Blue background inspired by the cake color */
        border-radius: 20px;
        padding: 40px 20px;
        text-align: center;
        margin: 20px auto;
        max-width: 600px;
        box-shadow: inset 0 5px 20px rgba(0, 0, 0, 0.2);
        /* Make sure the empty screen takes up grid space if needed */
        grid-column: 1 / -1; /* Span across all columns if grid is empty */
      }

      .empty-screen .vine-text {
        font-family: "Dancing Script", cursive;
        font-size: 2.5em;
        color: #e52e71; /* Vine red font */
        margin: 0;
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
      }

      .empty-screen .vine-decoration {
        margin-top: 20px;
        background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' preserveAspectRatio='none' viewBox='0 0 200 50'><path d='M0 25 C50 0, 150 50, 200 25' fill='none' stroke='%23e52e71' stroke-width='4'/></svg>")
          no-repeat center;
        background-size: cover;
        height: 50px;
      }

       /* Loading and Error states */
      .loading, .error {
          text-align: center;
          padding: 40px;
          font-size: 1.2em;
          color: #555;
          grid-column: 1 / -1; /* Span across all columns */
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .channel-header {
          flex-direction: column;
          text-align: center;
        }

        .channel-avatar {
          margin-right: 0;
          margin-bottom: 10px;
        }

        .subscribe-button {
          margin-top: 15px;
        }

        .video-details {
          flex-direction: column;
          align-items: flex-start;
        }

        .video-actions {
          margin-top: 10px;
        }

        .video-grid {
             grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Adjust for smaller screens */
        }
      }
      @media (max-width: 480px) {
          .video-grid {
             grid-template-columns: 1fr; /* Stack videos on very small screens */
          }
          .welcome-text {
              font-size: 2em;
          }
          .channel-name {
              font-size: 1.5em;
          }
          .video-title-large {
              font-size: 1.3em;
          }
      }

    </style>

    <!-- Google tag (gtag.js) - ADDED HERE -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L2STL9VKKR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-L2STL9VKKR');
    </script>
    <!-- End Google tag -->

  </head>
  <body>
    <div class="welcome-banner">
      <h1 class="welcome-text">Bienvenidos a mi canal</h1>
    </div>
    <div class="container">
      <div id="channel-container" class="channel-header">
        <div class="loading">Cargando información del canal...</div>
      </div>

      <!-- New player section -->
      <div id="player-section" class="player-section">
        <div class="player-container">
          <div id="youtube-player"></div>
        </div>
        <h2 id="playing-title" class="video-title-large"></h2>
        <div class="video-details">
          <div class="video-meta">
            <span id="playing-views"></span> • <span id="playing-date"></span>
          </div>
          <div class="video-actions">
            <button class="action-button" id="like-button" title="Me gusta (simulado)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1"> <!-- Adjusted fill/stroke -->
                <path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"></path>
              </svg>
              Me gusta
            </button>
            <button class="action-button" id="share-button" title="Compartir video">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <!-- Adjusted SVG attributes -->
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
              Compartir
            </button>
          </div>
        </div>
      </div>

      <div id="videos-container" class="video-grid">
        <!-- Placeholder while loading -->
        <div class="loading">Cargando videos...</div>
        <!-- This empty screen placeholder will be shown by JS if no videos are found -->
        <div id="empty-screen" class="empty-screen" style="display: none;">
          <div class="vine-text">No hay videos disponibles</div>
          <div class="vine-decoration"></div>
        </div>
      </div>
    </div>

    <!-- Load YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
      // --- Configuration ---
      const API_KEY = "AIzaSyDSEq_geih__vsiq6P66cZ80PI27p4-DVU"; // Using your new API key
      const CHANNEL_ID = "UCw_SZuRMPAFSxWFGr3IhAZQ";

      const channelContainer = document.getElementById("channel-container");
      const videosContainer = document.getElementById("videos-container");
      const playerSection = document.getElementById("player-section");
      const playingTitle = document.getElementById("playing-title");
      const playingViews = document.getElementById("playing-views");
      const playingDate = document.getElementById("playing-date");
      const emptyScreen = document.getElementById("empty-screen");

      // YouTube Player global variable
      let player;

      // Store video data for quick access
      let videoDataMap = {};
      let currentVideoId = null; // Keep track of the currently playing video

      // --- YouTube Player Functions ---
      function onYouTubeIframeAPIReady() {
        // Player is initially created but not loaded with any video
        player = new YT.Player('youtube-player', {
          height: '100%',
          width: '100%',
          playerVars: {
            'playsinline': 1, // Important for mobile playback
            'rel': 0,         // Don't show related videos from other channels
            'modestbranding': 1 // Less YouTube branding
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      function onPlayerReady(event) {
        console.log("YouTube player is ready");
        // Player is ready, but we don't load a video until one is clicked
      }

      function onPlayerStateChange(event) {
        // Example: Track video plays in Google Analytics (if gtag is defined)
        if (event.data == YT.PlayerState.PLAYING && typeof gtag === 'function') {
             const videoData = player.getVideoData();
             if (videoData && videoData.title) {
                 gtag('event', 'video_play', {
                    'event_category': 'YouTube Player',
                    'event_label': videoData.title,
                    'video_id': videoData.video_id
                 });
             }
        }
        // Add other state change handling if needed (e.g., video ended)
      }

      function playVideo(videoId) {
        if (!player || typeof player.loadVideoById !== 'function') {
            console.error("YouTube player is not ready or invalid.");
            // Maybe try to initialize it again or show an error
            alert("El reproductor de video no está listo. Intenta de nuevo en unos momentos.");
            return;
        }

        // Show the player section
        playerSection.style.display = "block";

        // Load and play the video
        player.loadVideoById(videoId);
        currentVideoId = videoId; // Store the ID of the video being played

        // Update the video info displayed below the player
        updatePlayingVideoInfo(videoId);

        // Scroll to player smoothly
        playerSection.scrollIntoView({ behavior: 'smooth', block: 'start' }); // Scroll to the top of the player
      }

      function updatePlayingVideoInfo(videoId) {
        const videoData = videoDataMap[videoId];
        if (videoData) {
          playingTitle.textContent = videoData.title || "Video sin título";
          playingViews.textContent = `${formatViewCount(videoData.viewCount)} vistas`;
          playingDate.textContent = formatPublishedDate(videoData.publishedAt);
        } else {
          // Fallback if data not found (shouldn't normally happen)
           playingTitle.textContent = "Cargando información...";
           playingViews.textContent = "";
           playingDate.textContent = "";
        }
      }

      // --- Utility Functions ---
      function formatViewCount(count) {
        const num = Number(count); // Ensure it's a number
        if (isNaN(num)) return 'N/A';
        if (num >= 1e6) return (num / 1e6).toFixed(1).replace('.0','') + "M";
        if (num >= 1e3) return (num / 1e3).toFixed(1).replace('.0','') + "K";
        return num.toString();
      }

      function formatDuration(duration) {
         if (!duration) return "0:00"; // Handle case where duration might be missing
        const match = duration.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
        if (!match) return "0:00"; // Handle parsing errors

        // Parse the results, providing defaults of 0
        const hours = parseInt(match[1] || "0");
        const minutes = parseInt(match[2] || "0");
        const seconds = parseInt(match[3] || "0");

        // Format the time string
        let timeString = "";
        if (hours > 0) {
            timeString += `${hours}:${minutes.toString().padStart(2, "0")}:`;
        } else {
            timeString += `${minutes}:`;
        }
        timeString += seconds.toString().padStart(2, "0");

        return timeString;
      }

      function formatPublishedDate(dateString) {
         try {
             const published = new Date(dateString);
             const now = new Date();
             const diffTime = now - published; // Difference in milliseconds

             const diffSeconds = Math.floor(diffTime / 1000);
             const diffMinutes = Math.floor(diffSeconds / 60);
             const diffHours = Math.floor(diffMinutes / 60);
             const diffDays = Math.floor(diffHours / 24);
             const diffWeeks = Math.floor(diffDays / 7);
             const diffMonths = Math.floor(diffDays / 30.44); // Average month length
             const diffYears = Math.floor(diffDays / 365.25); // Account for leap years

             if (diffYears > 0) return `Hace ${diffYears} año${diffYears > 1 ? 's' : ''}`;
             if (diffMonths > 0) return `Hace ${diffMonths} mes${diffMonths > 1 ? 'es' : ''}`;
             if (diffWeeks > 0) return `Hace ${diffWeeks} semana${diffWeeks > 1 ? 's' : ''}`;
             if (diffDays > 0) return `Hace ${diffDays} día${diffDays > 1 ? 's' : ''}`;
             if (diffHours > 0) return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
             if (diffMinutes > 0) return `Hace ${diffMinutes} minuto${diffMinutes > 1 ? 's' : ''}`;
             return "Hace unos segundos";

         } catch (error) {
             console.error("Error formatting date:", dateString, error);
             return "Fecha desconocida"; // Fallback for invalid dates
         }
      }

      // --- Fetch Functions ---
      async function fetchChannelInfo() {
        const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${CHANNEL_ID}&key=${API_KEY}`;
        try {
          const response = await fetch(url);
          if (!response.ok) {
              const errorData = await response.json();
              throw new Error(`Error ${response.status}: ${errorData.error?.message || 'Failed to fetch channel data'}`);
          }
          const data = await response.json();

          if (!data.items || data.items.length === 0) throw new Error("Canal no encontrado");

          const channel = data.items[0];
          const snippet = channel.snippet;
          const stats = channel.statistics;

          const html = `
            <img class="channel-avatar" src="${snippet?.thumbnails?.default?.url || ''}" alt="Avatar del Canal">
            <div class="channel-info">
              <h2 class="channel-name">${snippet?.title || 'Nombre del Canal'}</h2>
              <div class="channel-stats">${formatViewCount(stats?.subscriberCount || 0)} suscriptores • ${stats?.videoCount || 0} videos</div>
            </div>
            <a href="https://www.youtube.com/channel/${CHANNEL_ID}?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="subscribe-button">Suscribirse</a>
          `; // Used an <a> tag for better practice on the subscribe button
          channelContainer.innerHTML = html;
        } catch (error) {
          console.error("Error fetching channel info:", error);
          channelContainer.innerHTML = `<div class="error">Error al cargar información del canal: ${error.message}</div>`;
        }
      }

      async function fetchChannelVideos() {
          const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&maxResults=12&order=date&type=video&key=${API_KEY}`;
          try {
              const response = await fetch(searchUrl);
              if (!response.ok) {
                  const errorData = await response.json();
                  throw new Error(`Error ${response.status}: ${errorData.error?.message || 'Failed to fetch video list'}`);
              }
              const data = await response.json();

              if (!data.items || data.items.length === 0) {
                  // No videos found - show the empty screen placeholder
                  videosContainer.innerHTML = ''; // Clear loading message
                  emptyScreen.style.display = 'block'; // Show the empty screen div
                  return; // Stop execution here
              }

              // Hide empty screen if it was previously shown
              emptyScreen.style.display = 'none';

              const videoIds = data.items.map((item) => item.id.videoId).join(",");
              const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoIds}&key=${API_KEY}`;

              const detailsResponse = await fetch(detailsUrl);
              if (!detailsResponse.ok) {
                   const errorData = await detailsResponse.json();
                   throw new Error(`Error ${detailsResponse.status}: ${errorData.error?.message || 'Failed to fetch video details'}`);
              }
              const detailsData = await detailsResponse.json();

              // Create a map of video details for easier lookup
              const detailsMap = {};
              detailsData.items.forEach(item => {
                  detailsMap[item.id] = {
                      duration: item.contentDetails?.duration,
                      viewCount: item.statistics?.viewCount
                  };
              });

              // Build HTML for video cards
              const videosHTML = data.items
                  .map((item) => {
                      const videoId = item.id.videoId;
                      const snippet = item.snippet;
                      const details = detailsMap[videoId] || {}; // Get details or empty object

                      // Store comprehensive video data for the player info section
                      videoDataMap[videoId] = {
                          title: snippet?.title || "Video sin título",
                          viewCount: details.viewCount || 0,
                          publishedAt: snippet?.publishedAt,
                          duration: details.duration, // Store duration from details
                          thumbnail: snippet?.thumbnails?.high?.url || snippet?.thumbnails?.medium?.url || '', // Fallback thumbnails
                          channelTitle: snippet?.channelTitle || ''
                      };

                      return `
                          <div class="video-card" onclick="playVideo('${videoId}')" title="Reproducir: ${snippet?.title || ''}">
                              <div class="thumbnail">
                                  <img src="${videoDataMap[videoId].thumbnail}" alt="Miniatura de ${snippet?.title || 'video'}">
                                  <span class="video-duration">${formatDuration(details.duration)}</span>
                              </div>
                              <div class="video-info">
                                  <div class="video-title">${snippet?.title || 'Video sin título'}</div>
                                  <div class="video-channel">${snippet?.channelTitle || ''}</div>
                                  <div class="video-stats">${formatViewCount(details.viewCount || 0)} vistas • ${formatPublishedDate(snippet?.publishedAt)}</div>
                              </div>
                          </div>
                      `;
                  })
                  .join("");

              videosContainer.innerHTML = videosHTML; // Replace loading message with video grid

          } catch (error) {
              console.error("Error fetching channel videos:", error);
              // Display error within the videos container
              videosContainer.innerHTML = `<div class="error">Error al cargar videos: ${error.message}</div>`;
               emptyScreen.style.display = 'none'; // Ensure empty screen is hidden on error
          }
      }

      // --- Action Button Listeners ---
      document.getElementById('like-button').addEventListener('click', function() {
        // Note: This is a cosmetic like button, it doesn't actually interact with YouTube's like system.
        alert('¡Gracias por indicar que te gusta! (Esta es una demostración)');
         // Optional: Change button appearance slightly
         this.style.color = '#e52e71'; // Example color change
         setTimeout(() => { this.style.color = 'currentColor'; }, 1000); // Revert after 1 second

         // Optional: Track click in Google Analytics
          if (currentVideoId && typeof gtag === 'function') {
              gtag('event', 'like_button_click', {
                'event_category': 'User Interaction',
                'event_label': videoDataMap[currentVideoId]?.title || 'Unknown Video',
                'video_id': currentVideoId
              });
          }
      });

      document.getElementById('share-button').addEventListener('click', function() {
          if (!currentVideoId) {
              alert("Primero reproduce un video para poder compartirlo.");
              return;
          }

          const videoData = videoDataMap[currentVideoId];
          const shareUrl = `https://youtu.be/${currentVideoId}`;
          const shareTitle = videoData?.title || 'Mira este video';

          // Track share attempt in Google Analytics
           if (typeof gtag === 'function') {
               gtag('event', 'share_button_click', {
                 'event_category': 'User Interaction',
                 'event_label': shareTitle,
                 'video_id': currentVideoId
               });
           }

          // Try to use Web Share API first (modern browsers, especially mobile)
          if (navigator.share) {
              navigator.share({
                  title: shareTitle,
                  text: `Mira "${shareTitle}" de Blogs Con Juli!`, // Optional text
                  url: shareUrl
              }).then(() => {
                  console.log('Shared successfully');
                  // Optional: Track successful share via API
                  if (typeof gtag === 'function') {
                      gtag('event', 'share_success_api', {'event_category': 'User Interaction','video_id': currentVideoId});
                  }
              }).catch((error) => {
                  console.error('Error sharing:', error);
                  // Fallback if share fails or is cancelled (though often cancel doesn't throw error)
                  // Don't show prompt if error is just cancellation by user
                  if (!error.message.toLowerCase().includes('abort')) {
                     prompt('Copia este enlace para compartir:', shareUrl);
                  }
              });
          } else {
              // Fallback for browsers that don't support Web Share API
              prompt('Copia este enlace para compartir:', shareUrl);
          }
      });

      // --- Initialize ---
      fetchChannelInfo();
      fetchChannelVideos();

    </script>
  </body>
</html>
