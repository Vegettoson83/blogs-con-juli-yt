<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ========= SEO Meta Tags (for Indexing by Search Engines) ========= -->
    <title>Blogs Con Juli - Videos Recientes de YouTube</title> <!-- More descriptive title -->
    <meta name="description" content="Explora los últimos videos del canal de YouTube 'Blogs Con Juli'. Mira tutoriales, vlogs y más contenido directamente aquí." />
    <!-- You could add keywords too, though less important now: <meta name="keywords" content="Blogs Con Juli, youtube, videos, vlogs, tutoriales"> -->
    <!-- ================================================================== -->

    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- Global Page Styles --- */
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        color: #333;
      }

      .welcome-banner {
        background: #eaeaea;
        text-align: center;
        padding: 20px;
      }

      .welcome-text {
        font-family: "Dancing Script", cursive;
        font-size: 2.5em;
        margin: 0;
      }

      .container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
      }

      .channel-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
        padding: 10px;
        background: #fff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }

      .channel-avatar {
        border-radius: 50%;
        margin-right: 20px;
        width: 80px; /* Added specific size */
        height: 80px; /* Added specific size */
      }

      .channel-info {
        flex-grow: 1;
      }

      .channel-name {
        font-size: 1.8em;
        margin: 0;
      }

      .channel-stats {
        color: #555;
      }

      /* New player section */
      .player-section {
        display: none; /* Initially hidden */
        margin-bottom: 30px;
      }

      .player-container {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
        height: 0;
        overflow: hidden;
        background: #000;
        border-radius: 8px;
      }

      .player-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      .video-title-large {
        font-size: 1.5em;
        margin: 15px 0 5px;
        font-weight: bold;
      }

      .video-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap; /* Allow wrapping on small screens */
        gap: 10px; /* Add gap for wrapped items */
      }

      .video-meta {
        color: #777;
        flex-shrink: 0; /* Prevent shrinking */
      }

      .video-actions {
        display: flex;
        gap: 10px;
        flex-shrink: 0; /* Prevent shrinking */
      }

      .action-button {
        display: flex;
        align-items: center;
        gap: 5px;
        background: #f1f1f1;
        border: none;
        padding: 8px 12px;
        border-radius: 20px;
        cursor: pointer;
        transition: background 0.2s;
        font-size: 0.9em; /* Slightly smaller text */
      }

      .action-button svg {
        width: 18px; /* Consistent icon size */
        height: 18px;
      }

      .action-button:hover {
        background: #e0e0e0;
      }

      /* Video grid styles */
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .video-card {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        display: flex; /* Added for flex layout */
        flex-direction: column; /* Stack thumbnail and info vertically */
      }

      .video-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }

      .thumbnail {
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* 16:9 aspect ratio for thumbnail area */
        height: 0;
        overflow: hidden; /* Ensure image stays within bounds */
      }

      .thumbnail img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover; /* Cover the area without distortion */
        display: block;
      }

      .video-duration {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.8em;
      }

      .video-info {
        padding: 12px;
        flex-grow: 1; /* Allow info section to grow */
        display: flex;
        flex-direction: column;
        justify-content: space-between; /* Push stats to bottom */
      }

      .video-title {
        font-size: 1.05em; /* Adjusted size */
        margin-bottom: 6px;
        font-weight: 600; /* Slightly bolder */
        line-height: 1.3;
         /* Limit title lines */
        max-height: 2.6em; /* Approx 2 lines */
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
      }

      .video-channel,
      .video-stats {
        font-size: 0.85em; /* Adjusted size */
        color: #555; /* Darker grey */
        line-height: 1.4;
      }
      .video-channel {
          margin-bottom: 4px;
      }


      /* --- Dynamic Color Changing Subscribe Button --- */
      .subscribe-button { /* Now targeting the <a> tag */
        padding: 10px 20px; /* Adjusted padding */
        font-size: 16px; /* Adjusted font size */
        color: #fff;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        background: linear-gradient(
          270deg,
          #ff8a00,
          #e52e71,
          #9b00ff,
          #ff8a00
        );
        background-size: 800% 800%;
        animation: colorShift 10s ease infinite;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-decoration: none; /* Remove underline from link */
        display: inline-block; /* Needed for padding/margin */
        text-align: center;
        flex-shrink: 0; /* Prevent shrinking in flex layout */
      }

      .subscribe-button:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      @keyframes colorShift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      /* --- Empty Screen Placeholder --- */
      .empty-screen {
        position: relative;
        background: #eef7ff; /* Lighter blue */
        border: 1px dashed #a0cfff; /* Dashed border */
        color: #334d6e; /* Darker text */
        border-radius: 10px;
        padding: 40px 20px;
        text-align: center;
        margin: 20px auto;
        max-width: 600px;
        box-shadow: none; /* Removed inner shadow */
        /* Make sure it takes up grid space */
        grid-column: 1 / -1; /* Span across all columns if grid is empty */
      }

      .empty-screen .vine-text {
        font-family: "Dancing Script", cursive;
        font-size: 2.2em; /* Slightly smaller */
        color: #0056b3; /* Blue color */
        margin: 0;
        text-shadow: none; /* Removed text shadow */
      }

      .empty-screen .vine-decoration {
        margin-top: 20px;
         /* Simplified decoration or remove if not needed */
         height: 5px;
         width: 80px;
         background: #a0cfff;
         margin-left: auto;
         margin-right: auto;
         border-radius: 3px;
      }

       /* Loading and Error states */
      .loading, .error {
          text-align: center;
          padding: 40px;
          font-size: 1.1em; /* Adjusted size */
          color: #555;
          grid-column: 1 / -1; /* Span across all columns */
      }
      .error {
          color: #d9534f; /* Error color */
          background-color: #f2dede;
          border: 1px solid #ebccd1;
          border-radius: 4px;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .channel-header {
          flex-direction: column;
          text-align: center;
          gap: 15px; /* Add gap for column layout */
        }

        .channel-avatar {
          margin-right: 0;
          margin-bottom: 0; /* Removed bottom margin */
        }

        .subscribe-button {
          margin-top: 0; /* Removed top margin */
          width: 80%; /* Make button wider on mobile */
          max-width: 250px;
        }

        .video-details {
          flex-direction: column;
          align-items: flex-start; /* Align items left */
          gap: 8px;
        }

        .video-actions {
          margin-top: 5px; /* Reduced margin */
          width: 100%; /* Make actions take full width */
          justify-content: flex-start; /* Align buttons left */
        }

         .video-grid {
             grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* Slightly larger minmax */
        }
      }
      @media (max-width: 480px) {
          .video-grid {
             grid-template-columns: 1fr; /* Stack videos on very small screens */
          }
          .welcome-text {
              font-size: 2em;
          }
          .channel-name {
              font-size: 1.5em;
          }
           .video-title-large {
              font-size: 1.3em;
          }
           .channel-avatar {
               width: 60px;
               height: 60px;
           }
           .subscribe-button {
               padding: 8px 16px;
               font-size: 15px;
           }
           .action-button {
               padding: 6px 10px;
               font-size: 0.85em;
           }
            .action-button svg {
                width: 16px;
                height: 16px;
            }
      }

    </style>

    <!-- Google tag (gtag.js) - For Visit Data Indexing by Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L2STL9VKKR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-L2STL9VKKR');
    </script>
    <!-- End Google tag -->

  </head>
  <body>
    <div class="welcome-banner">
      <h1 class="welcome-text">Bienvenidos a mi canal</h1>
    </div>
    <div class="container">
      <div id="channel-container" class="channel-header">
        <!-- Channel Info Loaded Here -->
        <div class="loading">Cargando información del canal...</div>
      </div>

      <!-- Player section -->
      <div id="player-section" class="player-section">
        <div class="player-container">
          <div id="youtube-player"></div>
        </div>
        <h2 id="playing-title" class="video-title-large"></h2>
        <div class="video-details">
          <div class="video-meta">
            <span id="playing-views"></span> • <span id="playing-date"></span>
          </div>
          <div class="video-actions">
            <button class="action-button" id="like-button" title="Me gusta (simulado)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1">
                <path d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z"></path>
              </svg>
              <span>Me gusta</span> <!-- Text in span for better control -->
            </button>
            <button class="action-button" id="share-button" title="Compartir video">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="18" cy="5" r="3"></circle>
                <circle cx="6" cy="12" r="3"></circle>
                <circle cx="18" cy="19" r="3"></circle>
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
              </svg>
              <span>Compartir</span> <!-- Text in span -->
            </button>
          </div>
        </div>
      </div>

      <!-- Video Grid -->
      <div id="videos-container" class="video-grid">
        <!-- Placeholder while loading -->
        <div class="loading">Cargando videos...</div>
        <!-- This empty screen placeholder will be shown by JS if no videos are found -->
        <div id="empty-screen" class="empty-screen" style="display: none;">
          <div class="vine-text">No hay videos disponibles por el momento.</div>
          <div class="vine-decoration"></div>
        </div>
      </div>
    </div>

    <!-- Load YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <!-- Main JavaScript -->
    <script>
      // --- Configuration ---
      const API_KEY = "AIzaSyDSEq_geih__vsiq6P66cZ80PI27p4-DVU"; // Your API key
      const CHANNEL_ID = "UCw_SZuRMPAFSxWFGr3IhAZQ"; // Your Channel ID

      // --- DOM Elements ---
      const channelContainer = document.getElementById("channel-container");
      const videosContainer = document.getElementById("videos-container");
      const playerSection = document.getElementById("player-section");
      const playingTitle = document.getElementById("playing-title");
      const playingViews = document.getElementById("playing-views");
      const playingDate = document.getElementById("playing-date");
      const emptyScreen = document.getElementById("empty-screen");
      const likeButton = document.getElementById('like-button');
      const shareButton = document.getElementById('share-button');

      // --- Global Variables ---
      let player; // YouTube Player instance
      let videoDataMap = {}; // Cache for video details
      let currentVideoId = null; // Track the currently playing video ID

      // --- YouTube Player API Functions ---
      function onYouTubeIframeAPIReady() {
        console.log("YouTube IFrame API Ready");
        player = new YT.Player('youtube-player', {
          height: '100%',
          width: '100%',
          playerVars: {
            'playsinline': 1,
            'rel': 0,
            'modestbranding': 1,
            'autoplay': 0 // Ensure autoplay is off initially
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange,
            'onError': onPlayerError
          }
        });
      }

      function onPlayerReady(event) {
        console.log("YouTube player is ready (onPlayerReady event)");
        // The player is ready, actions can be performed on it.
      }

      function onPlayerStateChange(event) {
         console.log("Player state changed:", event.data);
        // Send 'video_play' event to Google Analytics when video starts playing
        if (event.data === YT.PlayerState.PLAYING && typeof gtag === 'function') {
             const videoData = player.getVideoData();
             if (videoData?.video_id && videoData.title) {
                 console.log(`GA Event: video_play - ${videoData.title}`);
                 gtag('event', 'video_play', {
                    'event_category': 'YouTube Player',
                    'event_label': videoData.title.substring(0, 100), // Limit label length
                    'video_id': videoData.video_id
                 });
             }
        }
         // Example: Track video completion (State ENDED = 0)
         if (event.data === YT.PlayerState.ENDED && typeof gtag === 'function') {
             const videoData = player.getVideoData();
             if (videoData?.video_id && videoData.title) {
                 console.log(`GA Event: video_complete - ${videoData.title}`);
                 gtag('event', 'video_complete', {
                     'event_category': 'YouTube Player',
                     'event_label': videoData.title.substring(0, 100),
                     'video_id': videoData.video_id
                 });
             }
         }
      }

      function onPlayerError(event) {
          console.error("YouTube Player Error:", event.data);
          // You could display a message to the user or log this error
           playingTitle.textContent = "Error al cargar el video.";
           playingViews.textContent = "";
           playingDate.textContent = "";
           // Send error event to GA
           if (typeof gtag === 'function') {
               gtag('event', 'player_error', {
                   'event_category': 'YouTube Player',
                   'event_label': `Error code: ${event.data}`,
                   'video_id': currentVideoId || 'unknown'
               });
           }
      }

      // --- Core Application Functions ---
      function playVideo(videoId) {
        if (!player || typeof player.loadVideoById !== 'function') {
            console.error("Player not ready or invalid.");
            onYouTubeIframeAPIReady(); // Attempt to re-initialize if player is lost
            // Show user-friendly message
             alert("El reproductor de video no está listo. Por favor, espera un momento y vuelve a intentarlo.");
            return;
        }

        console.log(`Attempting to play video: ${videoId}`);
        playerSection.style.display = "block";
        player.loadVideoById(videoId); // Autoplay is handled by playerVars or might need event.target.playVideo() in onReady/onStateChange if issues persist
        player.playVideo(); // Explicitly call playVideo after loading

        currentVideoId = videoId;
        updatePlayingVideoInfo(videoId);

        // Smooth scroll to the player
        playerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function updatePlayingVideoInfo(videoId) {
        const videoData = videoDataMap[videoId];
        if (videoData) {
          playingTitle.textContent = videoData.title || "Video sin título";
          playingViews.textContent = `${formatViewCount(videoData.viewCount)} vistas`;
          playingDate.textContent = formatPublishedDate(videoData.publishedAt);
          console.log(`Updated info for video: ${videoId}`);
        } else {
           console.warn(`Video data not found in map for ID: ${videoId}`);
           playingTitle.textContent = "Cargando información...";
           playingViews.textContent = "";
           playingDate.textContent = "";
           // Attempt to fetch details again if missing? Could be complex.
        }
      }

       // --- Fetch Data Functions ---
      async function fetchData(url, type) {
          try {
              console.log(`Fetching ${type}: ${url}`);
              const response = await fetch(url);
              if (!response.ok) {
                  let errorMsg = `HTTP error! status: ${response.status}`;
                  try {
                      const errorData = await response.json();
                      errorMsg = `Error ${response.status}: ${errorData.error?.message || 'Failed to fetch data'}`;
                  } catch (jsonError) {
                      // If response is not JSON, use status text
                      errorMsg = `HTTP error! status: ${response.status} ${response.statusText}`;
                  }
                  throw new Error(errorMsg);
              }
              const data = await response.json();
              console.log(`Successfully fetched ${type}`);
              return data;
          } catch (error) {
              console.error(`Error fetching ${type}:`, error);
              throw error; // Re-throw the error to be caught by the caller
          }
      }

      async function fetchChannelInfo() {
        const url = `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${CHANNEL_ID}&key=${API_KEY}`;
        try {
          const data = await fetchData(url, 'Channel Info');
          if (!data.items || data.items.length === 0) throw new Error("Canal no encontrado en la respuesta de la API.");

          const channel = data.items[0];
          const snippet = channel.snippet || {};
          const stats = channel.statistics || {};

          // Default values for robustness
          const avatarUrl = snippet.thumbnails?.default?.url || 'placeholder-avatar.png'; // Provide a placeholder image path if needed
          const channelTitle = snippet.title || 'Nombre del Canal';
          const subscriberCount = stats.subscriberCount || 0;
          const videoCount = stats.videoCount || 0;

          const html = `
            <img class="channel-avatar" src="${avatarUrl}" alt="Avatar de ${channelTitle}">
            <div class="channel-info">
              <h2 class="channel-name">${channelTitle}</h2>
              <div class="channel-stats">${formatViewCount(subscriberCount)} suscriptores • ${videoCount} videos</div>
            </div>
            <a href="https://www.youtube.com/channel/${CHANNEL_ID}?sub_confirmation=1" target="_blank" rel="noopener noreferrer" class="subscribe-button" title="Suscribirse a ${channelTitle} en YouTube">Suscribirse</a>
          `;
          channelContainer.innerHTML = html;
        } catch (error) {
          channelContainer.innerHTML = `<div class="error">Error al cargar info del canal: ${error.message}</div>`;
        }
      }

      async function fetchChannelVideos() {
          const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${CHANNEL_ID}&maxResults=12&order=date&type=video&key=${API_KEY}`;
          try {
              const searchData = await fetchData(searchUrl, 'Video List');

              if (!searchData.items || searchData.items.length === 0) {
                  console.log("No videos found for this channel.");
                  videosContainer.innerHTML = ''; // Clear loading message
                  emptyScreen.style.display = 'block';
                  return;
              }

              emptyScreen.style.display = 'none'; // Hide empty screen if videos are found

              const videoIds = searchData.items.map(item => item.id?.videoId).filter(id => id).join(","); // Filter out potential undefined IDs
              if (!videoIds) {
                   throw new Error("No valid video IDs found in search results.");
              }

              const detailsUrl = `https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoIds}&key=${API_KEY}`;
              const detailsData = await fetchData(detailsUrl, 'Video Details');

              // Create a map of details for efficient lookup
              const detailsMap = {};
              detailsData.items?.forEach(item => {
                  if (item.id) {
                     detailsMap[item.id] = {
                         duration: item.contentDetails?.duration,
                         viewCount: item.statistics?.viewCount
                     };
                  }
              });

              // Clear previous video data cache
              videoDataMap = {};

              // Build video card HTML
              const videosHTML = searchData.items
                  .map((item) => {
                      const videoId = item.id?.videoId;
                      if (!videoId) return ''; // Skip if no videoId

                      const snippet = item.snippet || {};
                      const details = detailsMap[videoId] || {};

                      // Store comprehensive data in the map
                      videoDataMap[videoId] = {
                          title: snippet.title || "Video sin título",
                          viewCount: details.viewCount || 0,
                          publishedAt: snippet.publishedAt || new Date().toISOString(), // Fallback date
                          duration: details.duration,
                          thumbnail: snippet.thumbnails?.high?.url || snippet.thumbnails?.medium?.url || snippet.thumbnails?.default?.url || 'placeholder-thumb.png', // Thumbnail fallbacks
                          channelTitle: snippet.channelTitle || 'Canal Desconocido'
                      };

                      // Use cached data for display
                      const displayData = videoDataMap[videoId];

                      return `
                          <div class="video-card" onclick="playVideo('${videoId}')" title="Reproducir: ${displayData.title}">
                              <div class="thumbnail">
                                  <img src="${displayData.thumbnail}" alt="Miniatura de ${displayData.title}" loading="lazy">  <!-- Lazy loading -->
                                  <span class="video-duration">${formatDuration(displayData.duration)}</span>
                              </div>
                              <div class="video-info">
                                 <div> <!-- Wrapper for title and channel -->
                                     <div class="video-title">${displayData.title}</div>
                                     <div class="video-channel">${displayData.channelTitle}</div>
                                 </div>
                                  <div class="video-stats">${formatViewCount(displayData.viewCount)} vistas • ${formatPublishedDate(displayData.publishedAt)}</div>
                              </div>
                          </div>
                      `;
                  })
                  .join("");

              videosContainer.innerHTML = videosHTML || '<div class="loading">No se pudieron mostrar los videos.</div>'; // Fallback if map fails

          } catch (error) {
              console.error("Full error object fetching videos:", error); // Log the full error object
              videosContainer.innerHTML = `<div class="error">Error al cargar videos: ${error.message}. Revisa la consola para más detalles.</div>`;
              emptyScreen.style.display = 'none';
          }
      }


      // --- Utility Functions ---
      function formatViewCount(count) {
        const num = Number(count);
        if (isNaN(num) || num < 0) return '0'; // Handle invalid input
        if (num >= 1e6) return (num / 1e6).toFixed(1).replace('.0','') + "M";
        if (num >= 1e3) return (num / 1e3).toFixed(1).replace('.0','') + "K";
        return num.toString();
      }

      function formatDuration(isoDuration) {
         if (!isoDuration || typeof isoDuration !== 'string') return "0:00";
         // Regular expression to parse ISO 8601 duration (handles PT#H#M#S format)
         const regex = /P(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?)?/;
         const matches = isoDuration.match(regex);

         if (!matches) return "0:00"; // Return default if parsing fails

         const hours = matches[1] ? parseInt(matches[1], 10) : 0;
         const minutes = matches[2] ? parseInt(matches[2], 10) : 0;
         const seconds = matches[3] ? Math.round(parseFloat(matches[3])) : 0; // Round seconds

         // Format the time string
         let timeString = "";
         if (hours > 0) {
             timeString += `${hours}:${minutes.toString().padStart(2, '0')}:`;
         } else {
             timeString += `${minutes}:`;
         }
         timeString += seconds.toString().padStart(2, '0');

         return timeString;
      }

     function formatPublishedDate(dateString) {
         try {
             if (!dateString) throw new Error("Invalid date string provided");
             const published = new Date(dateString);
             // Check if the date is valid
             if (isNaN(published.getTime())) throw new Error("Parsed date is invalid");

             const now = new Date();
             const diffTime = now - published;

             // Handle future dates (though unlikely for published videos)
             if (diffTime < 0) return "Próximamente";

             const diffSeconds = Math.max(0, Math.floor(diffTime / 1000));
             const diffMinutes = Math.floor(diffSeconds / 60);
             const diffHours = Math.floor(diffMinutes / 60);
             const diffDays = Math.floor(diffHours / 24);
             const diffWeeks = Math.floor(diffDays / 7);
             const diffMonths = Math.floor(diffDays / 30.44);
             const diffYears = Math.floor(diffDays / 365.25);

             if (diffYears >= 1) return `Hace ${diffYears} año${diffYears > 1 ? 's' : ''}`;
             if (diffMonths >= 1) return `Hace ${diffMonths} mes${diffMonths > 1 ? 'es' : ''}`;
             if (diffWeeks >= 1) return `Hace ${diffWeeks} semana${diffWeeks > 1 ? 's' : ''}`;
             if (diffDays >= 1) return `Hace ${diffDays} día${diffDays > 1 ? 's' : ''}`;
             if (diffHours >= 1) return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
             if (diffMinutes >= 1) return `Hace ${diffMinutes} minuto${diffMinutes > 1 ? 's' : ''}`;
             return "Hace unos segundos";

         } catch (error) {
             console.error("Error formatting date:", dateString, error);
             return "Fecha desconocida";
         }
      }

      // --- Event Listeners for Action Buttons ---
      likeButton.addEventListener('click', function() {
        alert('¡Gracias por tu Me Gusta! (Función simulada)');
        this.classList.add('liked'); // Example: add a class for visual feedback
        setTimeout(() => { this.classList.remove('liked'); }, 1500); // Remove class after a while

        // Track click in Google Analytics
        if (currentVideoId && typeof gtag === 'function') {
             const videoTitle = videoDataMap[currentVideoId]?.title || 'Unknown Video';
             console.log(`GA Event: like_button_click - ${videoTitle}`);
             gtag('event', 'like_button_click', {
                'event_category': 'User Interaction',
                'event_label': videoTitle.substring(0, 100),
                'video_id': currentVideoId
             });
         }
      });

      shareButton.addEventListener('click', function() {
          if (!currentVideoId) {
              alert("Por favor, reproduce un video antes de intentar compartirlo.");
              return;
          }

          const videoData = videoDataMap[currentVideoId];
          const shareUrl = `https://youtu.be/${currentVideoId}`;
          const shareTitle = videoData?.title || 'Mira este video';
          const shareText = `¡Echa un vistazo a este video de ${videoData?.channelTitle || 'Blogs Con Juli'}: "${shareTitle}"!`;

          // Track share attempt in GA
          if (typeof gtag === 'function') {
              console.log(`GA Event: share_button_click - ${shareTitle}`);
              gtag('event', 'share_button_click', {
                 'event_category': 'User Interaction',
                 'event_label': shareTitle.substring(0, 100),
                 'video_id': currentVideoId
              });
          }

          // Use Web Share API if available
          if (navigator.share) {
              navigator.share({
                  title: shareTitle,
                  text: shareText,
                  url: shareUrl
              }).then(() => {
                  console.log('Shared successfully via Web Share API');
                  // Optional: Track successful share
                   if (typeof gtag === 'function') {
                       gtag('event', 'share_success_api', {'event_category': 'User Interaction','video_id': currentVideoId});
                   }
              }).catch((error) => {
                  // Don't show prompt if user cancelled (AbortError)
                  if (error.name !== 'AbortError') {
                      console.error('Error sharing:', error);
                      prompt('No se pudo usar la función de compartir. Copia este enlace:', shareUrl);
                       if (typeof gtag === 'function') {
                           gtag('event', 'share_fail_api', {'event_category': 'User Interaction','video_id': currentVideoId, 'error': error.message});
                       }
                  } else {
                      console.log('Share cancelled by user.');
                       if (typeof gtag === 'function') {
                           gtag('event', 'share_cancel_api', {'event_category': 'User Interaction','video_id': currentVideoId});
                       }
                  }
              });
          } else {
              // Fallback for browsers without Web Share API
              console.log('Web Share API not supported, using prompt.');
              prompt('Copia este enlace para compartir:', shareUrl);
               if (typeof gtag === 'function') {
                   gtag('event', 'share_fallback_prompt', {'event_category': 'User Interaction','video_id': currentVideoId});
               }
          }
      });

      // --- Initial Load ---
      function initializeApp() {
          console.log("Initializing App");
          fetchChannelInfo(); // Fetch channel details
          fetchChannelVideos(); // Fetch video list
          // Player is initialized via onYouTubeIframeAPIReady callback
      }

      // Make sure initialization happens after the DOM is fully loaded
      if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', initializeApp);
      } else {
          initializeApp(); // DOMContentLoaded has already fired
      }

    </script>
  </body>
</html>
