<select id="video-filter">
  <option value="all">Todos</option>
  <option value="shorts">Solo Shorts</option>
  <option value="videos">Solo Videos</option>
</select>

<div id="videos-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-top: 20px;"></div>

<button id="load-more" style="margin: 20px auto; display: block; padding: 10px 20px; font-size: 16px; cursor: pointer;">Load More</button>

<script>
  const API_KEY = 'YOUR_YOUTUBE_API_KEY';
  const CHANNEL_ID = 'UCw_SZuRMPAFSxWFGr3IhAZQ';
  const UPLOADS_PLAYLIST_ID = `UU${CHANNEL_ID.substring(2)}`;

  const videosContainer = document.getElementById('videos-container');
  const filterSelect = document.getElementById('video-filter');
  const loadMoreBtn = document.getElementById('load-more');

  let nextPageToken = '';
  let currentFilter = 'all';

  function formatDuration(isoDuration) {
    const match = isoDuration.match(/PT(?:(\d+)M)?(?:(\d+)S)?/);
    const minutes = parseInt(match?.[1] || 0);
    const seconds = parseInt(match?.[2] || 0);
    return `${minutes}:${seconds.toString().padStart(2, '0')}`;
  }

  function formatViews(count) {
    const num = parseInt(count);
    if (num >= 1_000_000) return (num / 1_000_000).toFixed(1).replace(/\.0$/, '') + 'M views';
    if (num >= 1_000) return (num / 1_000).toFixed(1).replace(/\.0$/, '') + 'K views';
    return num + ' views';
  }

  async function fetchChannelVideos(filterType = 'all', loadMore = false) {
    try {
      let apiUrl = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&playlistId=${UPLOADS_PLAYLIST_ID}&maxResults=12&key=${API_KEY}`;
      if (nextPageToken) apiUrl += `&pageToken=${nextPageToken}`;

      const response = await fetch(apiUrl);
      const data = await response.json();
      nextPageToken = data.nextPageToken || '';

      if (!data.items || data.items.length === 0) throw new Error('No videos available');

      const videoMap = {};
      data.items.forEach(item => {
        videoMap[item.contentDetails.videoId] = item.snippet;
      });

      const videoIds = Object.keys(videoMap).join(',');
      const detailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoIds}&key=${API_KEY}`);
      const detailsData = await detailsResponse.json();

      const filteredVideos = detailsData.items.filter(video => {
        const duration = video.contentDetails.duration;
        const isShort = duration.includes('PT') && !duration.includes('H') && parseInt(duration.match(/(\d+)M/)?.[1] || 0) < 1;
        if (filterType === 'shorts') return isShort;
        if (filterType === 'videos') return !isShort;
        return true;
      });

      const html = filteredVideos.map(video => {
        const snippet = videoMap[video.id];
        const thumbUrl = snippet.thumbnails.high.url;
        const videoId = video.id;

        return `
          <div class="video-card" style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: #fff; position: relative;">
            <div class="thumbnail" style="position: relative;">
              <img src="${thumbUrl}" alt="Thumbnail" loading="lazy" style="width: 100%; display: block;">
              <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${videoId}" frameborder="0"
                allow="autoplay" style="width:100%; height:100%; position:absolute; top:0; left:0; display:none; border-radius: 8px;"></iframe>
              <span class="video-duration" style="position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8); color: #fff; padding: 2px 6px; font-size: 12px; border-radius: 4px;">
                ${formatDuration(video.contentDetails.duration)}
              </span>
            </div>
            <div class="video-info" style="padding: 8px;">
              <div class="video-title" style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">${snippet.title}</div>
              <div class="video-channel" style="font-size: 12px; color: #555;">${snippet.channelTitle}</div>
              <div class="video-stats" style="font-size: 12px; color: #555;">${formatViews(video.statistics.viewCount)}</div>
            </div>
          </div>
        `;
      }).join('');

      if (!loadMore) {
        videosContainer.innerHTML = html;
      } else {
        videosContainer.insertAdjacentHTML('beforeend', html);
      }

      attachHoverPreviews();

      loadMoreBtn.style.display = nextPageToken ? 'block' : 'none';
    } catch (error) {
      console.error('Error fetching videos:', error);
      videosContainer.innerHTML = `<div class="error">Error fetching videos: ${error.message}</div>`;
    }
  }

  function attachHoverPreviews() {
    document.querySelectorAll('.video-card').forEach(card => {
      const img = card.querySelector('img');
      const iframe = card.querySelector('iframe');
      card.addEventListener('mouseenter', () => {
        img.style.display = 'none';
        iframe.style.display = 'block';
      });
      card.addEventListener('mouseleave', () => {
        iframe.style.display = 'none';
        img.style.display = 'block';
      });
    });
  }

  filterSelect.addEventListener('change', () => {
    currentFilter = filterSelect.value;
    nextPageToken = ''; // reset page token on filter change
    fetchChannelVideos(currentFilter);
  });

  loadMoreBtn.addEventListener('click', () => fetchChannelVideos(currentFilter, true));

  fetchChannelVideos();
</script>
