<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogs Con Juli - YouTube Feed</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; color: #333; }
    .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
    .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .video-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; overflow: hidden; transition: transform 0.3s ease; }
    .video-card:hover { transform: translateY(-5px); }
    .thumbnail img { width: 100%; }
    .video-info { padding: 10px; }
    .video-title { font-size: 1.1em; font-weight: bold; }
    .video-stats { font-size: 0.9em; color: #777; }
    #last-viewed-date { font-style: italic; color: #555; }
    select { padding: 8px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bienvenidos a Blogs Con Juli</h1>
    <p id="last-viewed-date"></p>

    <label for="video-filter">Filtrar por tipo:</label>
    <select id="video-filter">
      <option value="all">Todos</option>
      <option value="shorts">Solo Shorts</option>
      <option value="videos">Solo Videos</option>
    </select>

    <h2>Últimos Videos</h2>
    <div id="videos-container" class="video-grid"></div>

    <h2>Videos Populares</h2>
    <div id="popular-videos-container" class="video-grid"></div>
  </div>

  <script>
    const API_KEY = 'YOUR_YOUTUBE_API_KEY';
    const CHANNEL_ID = 'UCw_SZuRMPAFSxWFGr3IhAZQ';
    const UPLOADS_PLAYLIST_ID = `UU${CHANNEL_ID.substring(2)}`;
    
    const videosContainer = document.getElementById('videos-container');
    const popularVideosContainer = document.getElementById('popular-videos-container');
    const filterSelect = document.getElementById('video-filter');
    const lastViewedElement = document.getElementById('last-viewed-date');

    // Save last viewed date
    const lastViewDateKey = "lastViewedDate";
    const lastViewed = localStorage.getItem(lastViewDateKey);
    lastViewedElement.innerHTML = lastViewed ? `Última visita: ${new Date(lastViewed).toLocaleDateString()}` : "Primera vez aquí!";
    localStorage.setItem(lastViewDateKey, new Date().toISOString());

    async function fetchVideos(filterType = 'all') {
      try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&playlistId=${UPLOADS_PLAYLIST_ID}&maxResults=12&key=${API_KEY}`);
        const data = await response.json();
        if (!data.items) throw new Error('No videos available');

        const videoIds = data.items.map(item => item.contentDetails.videoId).join(',');
        const detailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,statistics&id=${videoIds}&key=${API_KEY}`);
        const detailsData = await detailsResponse.json();

        const filteredVideos = detailsData.items.filter(video => {
          const duration = video.contentDetails.duration;
          const isShort = duration.includes('PT') && !duration.includes('H') && parseInt(duration.match(/(\d+)M/)?.[1] || 0) < 1;
          return filterType === 'shorts' ? isShort : filterType === 'videos' ? !isShort : true;
        });

        videosContainer.innerHTML = filteredVideos.map((video, index) => {
          const snippet = data.items[index].snippet;
          return `
            <div class="video-card">
              <div class="thumbnail"><img src="${snippet.thumbnails.high.url}" alt="Thumbnail"></div>
              <div class="video-info">
                <div class="video-title">${snippet.title}</div>
                <div class="video-stats">${video.statistics.viewCount} vistas</div>
              </div>
            </div>
          `;
        }).join('');
      } catch (error) {
        videosContainer.innerHTML = `<div>Error cargando videos: ${error.message}</div>`;
      }
    }

    async function fetchPopularVideos() {
      try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode=US&key=${API_KEY}&maxResults=5`);
        const data = await response.json();
        if (!data.items) throw new Error("No popular videos found");

        popularVideosContainer.innerHTML = data.items.map(video => `
          <div class="video-card">
            <div class="thumbnail"><img src="${video.snippet.thumbnails.high.url}" alt="Thumbnail"></div>
            <div class="video-info">
              <div class="video-title">${video.snippet.title}</div>
              <div class="video-stats">${video.statistics.viewCount} vistas</div>
            </div>
          </div>
        `).join('');
      } catch (error) {
        popularVideosContainer.innerHTML = `<div>Error cargando videos populares: ${error.message}</div>`;
      }
    }

    filterSelect.addEventListener('change', () => fetchVideos(filterSelect.value));

    fetchVideos();
    fetchPopularVideos();
  </script>
</body>
</html>
